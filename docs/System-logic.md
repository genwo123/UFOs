# UFO's 축제 주문 시스템 - 핵심 로직 설계서

**University Festival Order System - Logic Design Document v2.0**

📅 작성일: 2025-11-10  
🎯 목적: 결제 시스템을 제외한 순수 로직 설계  
👥 대상 독자: 개발팀, PM, 기획자

---

## 📑 목차

1. [시스템 개요](#1-시스템-개요)
2. [3계층 구조 설계](#2-3계층-구조-설계)
3. [주문 상태 전이도 (FSM)](#3-주문-상태-전이도-fsm)
4. [주방 디스플레이 로직](#4-주방-디스플레이-로직)
5. [실시간 동기화 전략](#5-실시간-동기화-전략)
6. [데이터 격리 및 집계](#6-데이터-격리-및-집계)
7. [부스 등록 프로세스](#7-부스-등록-프로세스)
8. [UI/UX 설계 원칙](#8-uiux-설계-원칙)
9. [핵심 제약사항](#9-핵심-제약사항)

---

## 1. 시스템 개요

### 1.1 목적

대학 축제나 행사에서 **사업자 등록 없이** 간편하게 주문/결제를 관리할 수 있는 시스템.  
**캐치테이블**과 같은 사용자 경험을 제공하면서, **주방 디스플레이**를 통해 효율적인 운영을 지원.

### 1.2 핵심 요구사항

| 구분 | 요구사항 |
|------|----------|
| **독립성** | 각 부스는 완전히 독립적으로 운영 |
| **통합성** | 대학 단위로 데이터 통합 및 집계 |
| **실시간** | 주문 상태가 모든 화면에 실시간 동기화 |
| **직관성** | 주방 화면은 테이블 번호와 메뉴가 명확히 표시 |
| **제약** | 테이블 수 제한 (UI 고려), 단기 운영(2-3일) |

### 1.3 사용 시나리오

```
[고객] 테이블3 QR 스캔
   ↓
[주문] 떡볶이 2개, 순대 1개 주문
   ↓
[시스템] 계좌이체 안내 (입금자명 입력)
   ↓
[관리자] 입금 확인 → 주문 수락
   ↓
[주방 디스플레이] "테이블3 - 떡볶이 x2, 순대 x1" 표시
   ↓
[주방] 조리 시작 버튼 → 조리중 상태
   ↓
[주방] 조리 완료 버튼 → 고객에게 알림 전송
   ↓
[고객] 알림 수신 → 픽업
```

---

## 2. 3계층 구조 설계

### 2.1 계층 정의

```
📱 플랫폼 관리자 (Level 0 - Super Admin)
  │
  └─ 🏛️ A대학교 (Level 1 - University Admin)
       ├─ 🏪 A-a부스 (Level 2 - Booth Owner)
       ├─ 🏪 A-b부스 (Level 2 - Booth Owner)
       └─ 🏪 A-c부스 (Level 2 - Booth Owner)
  
  └─ 🏛️ B대학교 (Level 1 - University Admin)
       ├─ 🏪 B-a부스
       └─ 🏪 B-b부스
```

### 2.2 각 계층의 역할

| 계층 | 역할 | 예시 | 접근 권한 |
|------|------|------|-----------|
| **플랫폼 (Level 0)** | 전체 시스템 관리<br>대학 승인<br>전체 통계 | UFO's 운영팀 | 모든 데이터 조회 가능 |
| **대학 (Level 1)** | 대학별 통합 관리<br>부스 승인<br>대학 내 통계 집계 | 부산대학교 2025 축제<br>학생회 또는 총학 | 자기 대학 소속 부스만 조회 |
| **부스 (Level 2)** | 실제 운영 주체<br>주문/메뉴 관리<br>매출 확인 | A부스 - 떡볶이집<br>B부스 - 음료 | 자기 부스 데이터만 조회 |

### 2.3 데이터 독립성 원칙

> **핵심 원칙:** "A대학의 a부스와 b부스는 서로의 데이터를 볼 수 없다. 하지만 A대학 관리자는 모든 부스의 통합 데이터를 볼 수 있다."

**구현 방법:**
- 모든 데이터에 `university_id`와 `booth_id` 포함
- API 호출 시 JWT 토큰의 권한에 따라 자동 필터링
- 부스 조회: `WHERE booth_id = {user.booth_id}`
- 대학 조회: `WHERE university_id = {user.university_id}`

---

## 3. 주문 상태 전이도 (FSM)

### 3.1 상태 정의

주문은 생성부터 완료까지 **9가지 명확한 상태**를 가지며, 각 상태 전이는 특정 이벤트에 의해서만 발생한다.

```
[1] CREATED (주문 생성)
    ↓ 고객이 주문 생성
    ↓
[2] PENDING_PAYMENT (결제 대기)
    ↓ 계좌이체 완료
    ↓ 관리자가 입금 확인
    ↓
[3] PAYMENT_CONFIRMED (결제 확인)
    ↓ 관리자가 주문 수락 버튼 클릭
    ↓ 🔥 여기서 주방으로 전송!
    ↓
[4] ACCEPTED (주문 접수)
    ↓ 주방에서 조리 시작 버튼
    ↓
[5] COOKING (조리중)
    ↓ 주방에서 조리 완료 버튼
    ↓ 고객에게 알림 전송
    ↓
[6] READY (조리 완료)
    ↓ 고객 픽업 or 서빙
    ↓
[7] COMPLETED (완료)

특수 상태:
[X] REJECTED (거절) - 재고 부족, 영업 종료 등
[X] CANCELLED (취소) - 고객 취소
```

### 3.2 상태별 상세 정보

| 상태 | 설명 | 누가 전이? | 다음 상태 | Socket.IO 이벤트 |
|------|------|-----------|-----------|------------------|
| `CREATED` | 고객이 주문 생성 | 고객 | `PENDING_PAYMENT` | `new_order` |
| `PENDING_PAYMENT` | 결제 대기중 | 관리자 | `PAYMENT_CONFIRMED` | `confirm_payment` |
| `PAYMENT_CONFIRMED` | 결제 확인됨 | 관리자 | `ACCEPTED` / `REJECTED` | `accept_order` |
| `ACCEPTED` | 주문 접수 ⭐️ | 주방 | `COOKING` | `start_cooking` |
| `COOKING` | 조리 중 | 주방 | `READY` | `finish_cooking` |
| `READY` | 조리 완료 (픽업 대기) | 관리자/주방 | `COMPLETED` | `complete_order` |
| `COMPLETED` | 픽업 완료 | - | - | - |
| `REJECTED` | 주문 거절 | 관리자 | - | `reject_order` |
| `CANCELLED` | 고객 취소 | 고객 | - | `cancel_order` |

### 3.3 핵심 전이 로직

#### 🔥 PAYMENT_CONFIRMED → ACCEPTED (가장 중요!)

이 전이가 발생할 때 **주방 디스플레이에 주문이 나타난다.**

```javascript
// 관리자가 '주문 수락' 버튼 클릭 시
socket.emit('accept_order', { order_id: 123 });

// 서버 처리
1. DB 업데이트: status = 'ACCEPTED'
2. 주방 화면에 전송: io.to(`kitchen_${booth_id}`).emit('order_accepted', order)
3. 고객에게 알림: io.to(`table_${booth_id}_${table_num}`).emit('order_status_update', {...})
```

#### 🔔 COOKING → READY (고객 알림)

주방에서 '조리 완료' 버튼을 누르면 **고객에게 즉시 알림**이 전송된다.

```javascript
// 주방에서 '조리 완료' 버튼 클릭 시
socket.emit('finish_cooking', { order_id: 123 });

// 서버 처리
1. DB 업데이트: status = 'READY'
2. 주방 화면 업데이트: '완료' 칼럼으로 이동
3. 고객 알림 전송: 진동 + 푸시 메시지 "조리가 완료되었습니다!"
```

---

## 4. 주방 디스플레이 로직

### 4.1 화면 구성 (칸반 보드 스타일)

주방 화면은 **3개의 칼럼**으로 구성된 칸반 보드 형태. 트렐로(Trello)처럼 작업 흐름을 시각화.

```
┌─────────────────────────────────────────────────────────────────┐
│                  A부스 주방 디스플레이                          │
├──────────────┬──────────────┬──────────────┬────────────────────┤
│   대기중     │    조리중    │   완료됨     │     통계 패널      │
│  (ACCEPTED)  │  (COOKING)   │   (READY)    │                    │
│   🔵 파란색  │   🟠 주황색  │   🟢 초록색  │                    │
├──────────────┼──────────────┼──────────────┼────────────────────┤
│              │              │              │  📊 오늘 통계      │
│ ┌──────────┐ │ ┌──────────┐ │ ┌──────────┐ │                    │
│ │테이블 3  │ │ │테이블 5  │ │ │테이블 1  │ │  총 주문: 42건    │
│ │ #A-015   │ │ │ #A-013   │ │ │ #A-010   │ │  대기중: 3건      │
│ │──────────│ │ │──────────│ │ │──────────│ │  조리중: 2건      │
│ │떡볶이 x2 │ │ │순대 x3   │ │ │김밥 x2   │ │  완료: 1건        │
│ │순대 x1   │ │ │튀김 x5   │ │ │떡볶이 x1 │ │                    │
│ │라면 x1   │ │ │콜라 x2   │ │ │          │ │  💰 총 매출       │
│ │──────────│ │ │──────────│ │ │[픽업완료]│ │  ₩1,250,000      │
│ │15:23 접수│ │ │15:20 시작│ │ │15:30 완료│ │                    │
│ │⏱️ 2분경과│ │ │⏱️ 5분경과│ │ │          │ │  🔥 평균 조리시간 │
│ │          │ │ │          │ │ │          │ │  8분              │
│ │[조리시작]│ │ │[조리완료]│ │ └──────────┘ │                    │
│ └──────────┘ │ └──────────┘ │              │                    │
│              │              │              │                    │
│ ┌──────────┐ │              │              │                    │
│ │테이블 7  │ │              │              │                    │
│ │ #A-016   │ │              │              │                    │
│ │──────────│ │              │              │                    │
│ │김치찌개x1│ │              │              │                    │
│ │공기밥 x2 │ │              │              │                    │
│ │──────────│ │              │              │                    │
│ │15:25 접수│ │              │              │                    │
│ │⏱️ 방금전 │ │              │              │                    │
│ │[조리시작]│ │              │              │                    │
│ └──────────┘ │              │              │                    │
└──────────────┴──────────────┴──────────────┴────────────────────┘
```

### 4.2 칼럼별 상세 정보

| 칼럼 | 포함 상태 | 표시 정보 | 액션 버튼 |
|------|-----------|-----------|-----------|
| **대기중** 🔵 | `ACCEPTED` | • 테이블 번호 (h2 크기, 굵게)<br>• 주문 번호 (#A-015)<br>• 메뉴 목록 (이름 + 수량)<br>• 접수 시간 (15:23)<br>• 경과 시간 (실시간) | `[조리 시작]` |
| **조리중** 🟠 | `COOKING` | • 테이블 번호<br>• 메뉴 목록<br>• 조리 시작 시간<br>• 경과 시간 (강조)<br>• 5분 이상 시 빨간색 경고 | `[조리 완료]` |
| **완료** 🟢 | `READY` | • 테이블 번호<br>• 완료 시간<br>• 픽업 대기 표시 | `[픽업 완료]` |

### 4.3 UI 원칙

1. **테이블 번호 최우선 표시** - 가장 크고 명확하게 (24px 이상)
2. **메뉴는 이름만** - 이미지 없음 (공간 절약, 빠른 인식)
3. **경과 시간 실시간 업데이트** - 1초마다 갱신
4. **5분 이상 대기 시 경고**
   - 빨간색 테두리
   - 깜빡임 효과 (blink animation)
   - 경고음 (선택 가능)
5. **새 주문 알림**
   - 알림음 재생
   - 브라우저 진동 API 사용 (모바일)
   - "대기중" 칼럼에 하이라이트 효과
6. **한 화면에 최대 20개 주문** - 페이지네이션 또는 스크롤

### 4.4 색상 코드

| 상태 | 색상 코드 | 의미 |
|------|----------|------|
| 대기중 | `#2196F3` (파란색) | 차분함, 준비 |
| 조리중 | `#FF9800` (주황색) | 진행중, 주의 |
| 완료 | `#4CAF50` (초록색) | 완료, 안전 |
| 경고 (5분 이상) | `#F44336` (빨간색) | 긴급, 지연 |

---

## 5. 실시간 동기화 전략

### 5.1 Socket.IO Room 구조

각 부스마다 독립적인 Socket.IO Room을 생성하여 **데이터 격리**를 보장한다.

```
┌─────────────────────────────────────────┐
│ booth_pusan_a                           │  ← A부스 전용 룸
│ ├─ socket_123 (관리자)                 │
│ ├─ socket_456 (주방 디스플레이)        │
│ └─ socket_789 (모바일 관리자)          │
├─────────────────────────────────────────┤
│ booth_pusan_b                           │  ← B부스 전용 룸
│ ├─ socket_321 (관리자)                 │
│ └─ socket_654 (주방 디스플레이)        │
├─────────────────────────────────────────┤
│ kitchen_pusan_a                         │  ← A부스 주방만
│ └─ socket_456 (주방 디스플레이)        │
├─────────────────────────────────────────┤
│ table_pusan_a_3                         │  ← A부스 테이블3 고객
│ └─ socket_999 (고객 모바일)            │
├─────────────────────────────────────────┤
│ univ_pusan_2025                         │  ← 부산대 전체 (집계용)
│ └─ socket_888 (대학 관리자)            │
└─────────────────────────────────────────┘
```

### 5.2 Room 분류

| Room 이름 | 참여자 | 용도 | 보안 수준 |
|-----------|--------|------|-----------|
| `booth_{booth_id}` | 관리자, 주방, 홀 직원 | 부스 내 모든 업데이트 | 중간 |
| `kitchen_{booth_id}` | 주방 디스플레이만 | 조리 관련 이벤트만 | 높음 |
| `table_{booth_id}_{table_num}` | 해당 테이블 고객 | 특정 테이블 주문 상태 | 낮음 |
| `univ_{university_id}` | 대학 관리자 | 대학 전체 통계 | 높음 |

### 5.3 핵심 이벤트

#### 클라이언트 → 서버 이벤트

| 이벤트 | 발신자 | 데이터 | 설명 |
|--------|--------|--------|------|
| `join_booth` | 모든 클라이언트 | `{ booth_id, role }` | Room 참여 |
| `new_order` | 고객 | `{ booth_id, table_number, items, ... }` | 새 주문 생성 |
| `confirm_payment` | 관리자 | `{ order_id }` | 결제 확인 |
| `accept_order` | 관리자 | `{ order_id }` | 주문 수락 |
| `reject_order` | 관리자 | `{ order_id, reason }` | 주문 거절 |
| `start_cooking` | 주방 | `{ order_id }` | 조리 시작 |
| `finish_cooking` | 주방 | `{ order_id }` | 조리 완료 |
| `complete_order` | 관리자/주방 | `{ order_id }` | 픽업 완료 |

#### 서버 → 클라이언트 이벤트

| 이벤트 | 수신자 | 데이터 | 트리거 시점 |
|--------|--------|--------|-------------|
| `order_pending_payment` | 관리자 | 주문 정보 | 고객 주문 생성 시 |
| `payment_confirmed` | 관리자 | 주문 정보 | 입금 확인 시 |
| `order_accepted` | 주방 + 고객 | 주문 정보 | 주문 수락 시 |
| `cooking_started` | 주방 (동기화) | 주문 ID | 조리 시작 시 |
| `cooking_finished` | 고객 + 주방 | 주문 ID | 조리 완료 시 |
| `order_completed` | 주방 | 주문 ID | 픽업 완료 시 |
| `order_rejected` | 고객 | `{ order_id, reason }` | 주문 거절 시 |
| `order_status_update` | 고객 | `{ status, message }` | 상태 변경 시 |

### 5.4 이벤트 흐름 예시

```
고객 주문 → 관리자 수락 → 주방 조리 → 고객 픽업

[고객 앱]
  socket.emit('new_order', {...})
        ↓
[서버]
  DB 저장 → io.to('booth_pusan_a').emit('order_pending_payment', order)
        ↓
[관리자 화면]
  수신 → 입금 확인 → socket.emit('accept_order', {order_id: 123})
        ↓
[서버]
  DB 업데이트 → io.to('kitchen_pusan_a').emit('order_accepted', order)
                 io.to('table_pusan_a_3').emit('order_status_update', {...})
        ↓
[주방 화면]                    [고객 앱]
  주문 표시                     "주문이 접수되었습니다!" 알림
        ↓
[주방 화면]
  조리 시작 버튼 클릭 → socket.emit('start_cooking', {order_id: 123})
        ↓
[서버]
  DB 업데이트 → io.to('kitchen_pusan_a').emit('cooking_started', order)
                 io.to('table_pusan_a_3').emit('order_status_update', {...})
        ↓
[주방 화면]                    [고객 앱]
  "조리중" 칼럼으로 이동        "조리가 시작되었습니다!" 알림
        ↓
[주방 화면]
  조리 완료 버튼 클릭 → socket.emit('finish_cooking', {order_id: 123})
        ↓
[서버]
  DB 업데이트 → io.to('kitchen_pusan_a').emit('cooking_finished', order)
                 io.to('table_pusan_a_3').emit('order_status_update', {...})
        ↓
[주방 화면]                    [고객 앱]
  "완료" 칼럼으로 이동          🔔 "조리가 완료되었습니다! 픽업해주세요." 
                               (진동 + 알림)
```

---

## 6. 데이터 격리 및 집계

### 6.1 데이터 소유권

모든 데이터는 명확한 **소유자**를 가지며, 접근 권한은 소유자 기준으로 결정된다.

```javascript
// 주문 데이터 예시
{
  id: 123,
  university_id: "pusan_2025",  // 집계용
  booth_id: "pusan_a",           // 실제 소유자
  table_number: 3,
  status: "cooking",
  items: [...]
}
```

**규칙:**
- `booth_id`: 실제 소유권 결정 (이 부스만 조회 가능)
- `university_id`: 집계용 (대학 관리자가 통계 볼 때 사용)

### 6.2 쿼리 패턴

#### 부스 단위 조회 (부스 운영자)

```sql
-- 부스 운영자는 자기 부스 것만 조회
SELECT * FROM orders 
WHERE booth_id = 'pusan_a'  -- JWT의 booth_id
ORDER BY created_at DESC;
```

#### 대학 단위 집계 (대학 관리자)

```sql
-- 대학 관리자는 소속 부스 전체 집계
SELECT 
  booth_id,
  COUNT(*) as total_orders,
  SUM(total_amount) as revenue
FROM orders 
WHERE university_id = 'pusan_2025'  -- JWT의 university_id
GROUP BY booth_id;
```

#### 플랫폼 단위 조회 (Super Admin)

```sql
-- 플랫폼 관리자는 모든 데이터 조회 가능
SELECT * FROM orders 
WHERE created_at >= '2025-05-01';
```

### 6.3 권한 체크 미들웨어

```javascript
// API 요청 시 자동으로 권한 체크
function checkPermission(req, res, next) {
  const { role, university_id, booth_id } = req.user;  // JWT에서 추출
  const { target_booth_id } = req.params;

  if (role === 'super_admin') {
    // 슈퍼 관리자는 모든 접근 허용
    return next();
  }

  if (role === 'university_admin') {
    // 대학 관리자는 자기 대학 부스만
    const booth = await Booth.findById(target_booth_id);
    if (booth.university_id !== university_id) {
      return res.status(403).json({ error: '권한 없음' });
    }
    return next();
  }

  if (role === 'booth_owner') {
    // 부스 운영자는 자기 부스만
    if (booth_id !== target_booth_id) {
      return res.status(403).json({ error: '권한 없음' });
    }
    return next();
  }

  return res.status(403).json({ error: '권한 없음' });
}
```

### 6.4 데이터 격리 보장

**핵심 원칙:** 모든 쿼리에 자동으로 필터 추가

```javascript
// ORM 사용 시 (예: Sequelize)
const orders = await Order.findAll({
  where: {
    booth_id: req.user.booth_id  // 자동 추가
  }
});

// 실수로 다른 부스 데이터를 가져올 수 없음!
```

---

## 7. 부스 등록 프로세스

### 7.1 4단계 마법사 (Wizard)

복잡한 부스 등록을 **4개의 간단한 단계**로 나눈다.  
각 단계는 독립적으로 저장되며, 중간에 나가도 **로컬 스토리지**로 다시 돌아올 수 있다.

```
Step 1: 기본 정보 → Step 2: 메뉴 등록 → Step 3: 테이블 설정 → Step 4: 완료
```

### 7.2 단계별 상세

| 단계 | 입력 항목 | 검증 사항 | 저장 위치 |
|------|-----------|-----------|-----------|
| **Step 1<br>기본 정보** | • 부스명<br>• 소속 대학 선택 (드롭다운)<br>• 운영 기간 (날짜 범위)<br>• 계좌번호 | • 부스명 중복 체크<br>• 대학 선택 필수<br>• 계좌번호 형식 검증 | `booths` 테이블<br>(status='draft') |
| **Step 2<br>메뉴 등록** | • 이미지 업로드 (드래그 & 드롭)<br>• 메뉴명, 가격, 재고<br>• 엑셀 일괄 업로드 옵션 | • 이미지 필수 체크<br>• 가격 > 0<br>• 최소 1개 이상 등록 | `menus` 테이블 |
| **Step 3<br>테이블 설정** | • 테이블 수량 입력<br>  (권장: 10개 이하) | • 1~20 범위 체크<br>• 20개 초과 시 경고<br>• QR 미리보기 제공 | QR 자동 생성<br>(백그라운드) |
| **Step 4<br>완료** | • QR 다운로드<br>• 설정 확인 및 최종 승인 | - | `booths` 테이블<br>(status='active') |

### 7.3 Step 2: 메뉴 등록 UX

#### 방법 1: 개별 등록

```
┌─────────────────────────────────────────────┐
│ 메뉴 등록                                   │
├─────────────────────────────────────────────┤
│                                             │
│ ┌─────────┐  ┌────────────────────────┐    │
│ │ 📷      │  │ 메뉴명: [떡볶이______]  │    │
│ │ 이미지  │  │ 가격:   [8000원_____]  │    │
│ │ 드래그  │  │ 재고:   [999________]  │    │
│ │ 또는    │  └────────────────────────┘    │
│ │ 클릭    │  [🗑️ 삭제]                    │
│ └─────────┘                                 │
│                                             │
│ ┌─────────┐  ┌────────────────────────┐    │
│ │ 📷      │  │ 메뉴명: [순대________]  │    │
│ │         │  │ 가격:   [7000원_____]  │    │
│ │         │  │ 재고:   [999________]  │    │
│ └─────────┘  └────────────────────────┘    │
│                                             │
│ [+ 메뉴 추가]                               │
│                                             │
│ [← 이전]              [다음 →]             │
└─────────────────────────────────────────────┘
```

**특징:**
- 드래그 & 드롭으로 쉬운 이미지 업로드
- 업로드 즉시 미리보기 표시
- 자동 리사이징 (800x800, 80% 품질)

#### 방법 2: 엑셀 일괄 업로드

```
┌─────────────────────────────────────────────┐
│ 엑셀로 메뉴 일괄 등록                       │
├─────────────────────────────────────────────┤
│                                             │
│ 1️⃣ 템플릿 다운로드                          │
│    [📥 템플릿 다운로드 (menu_template.xlsx)]│
│                                             │
│ 2️⃣ 엑셀 파일 업로드                         │
│    [📁 파일 선택]  menu_list.xlsx ✅        │
│                                             │
│ 3️⃣ 이미지 ZIP 업로드 (선택)                 │
│    [📁 파일 선택]  menu_images.zip ✅       │
│                                             │
│ 📋 미리보기 (10개 메뉴 감지됨)              │
│ ┌─────────────────────────────────────────┐ │
│ │ ✅ 떡볶이 - 8000원                      │ │
│ │ ✅ 순대 - 7000원                        │ │
│ │ ❌ 김밥 - 이미지 없음                   │ │
│ │ ...                                     │ │
│ └─────────────────────────────────────────┘ │
│                                             │
│ [← 개별 등록으로]         [등록 완료 →]    │
└─────────────────────────────────────────────┘
```

**템플릿 구조:**

| 메뉴명 | 가격 | 재고 | 이미지파일명 |
|--------|------|------|--------------|
| 떡볶이 | 8000 | 999 | tteokbokki.jpg |
| 순대 | 7000 | 999 | sundae.jpg |
| 튀김 | 5000 | 999 | fried.jpg |

### 7.4 Step 3: QR 생성

```
┌─────────────────────────────────────────────┐
│ 테이블 QR 코드 생성                         │
├─────────────────────────────────────────────┤
│                                             │
│ 테이블 개수를 입력하세요                    │
│ (권장: 10개 이하)                           │
│                                             │
│ ┌─────────┐                                 │
│ │   10    │ 개                              │
│ └─────────┘                                 │
│                                             │
│ ⚠️ 20개를 초과하면 주방 화면이              │
│    복잡해질 수 있습니다.                    │
│                                             │
│ 📋 생성될 QR 미리보기                       │
│ ┌──────┬──────┬──────┬──────┬──────┐       │
│ │ T1   │ T2   │ T3   │ T4   │ T5   │       │
│ │ [QR] │ [QR] │ [QR] │ [QR] │ [QR] │       │
│ ├──────┼──────┼──────┼──────┼──────┤       │
│ │ T6   │ T7   │ T8   │ T9   │ T10  │       │
│ │ [QR] │ [QR] │ [QR] │ [QR] │ [QR] │       │
│ └──────┴──────┴──────┴──────┴──────┘       │
│                                             │
│ [← 이전]              [생성 완료 →]        │
└─────────────────────────────────────────────┘
```

**QR 생성 규칙:**
- URL 형식: `/order/{booth_id}/{table_number}`
- 예시: `/order/pusan_a/3` (부산대 a부스 3번 테이블)
- 한번에 ZIP 파일로 다운로드
- 각 QR은 `{booth_name}_table_{number}.svg` 형식

---

## 8. UI/UX 설계 원칙

### 8.1 고객 화면 (QR 접속)

**목표:** 주문까지 최대한 빠르게 (3클릭 이내)

```
QR 스캔 → 메뉴 선택 → 주문 확인 → 완료
  (0초)    (30초)       (10초)     (5초)
```

**핵심 원칙:**

1. **로그인 불필요** - QR 스캔 즉시 메뉴 표시
2. **큰 이미지 + 명확한 가격** - 가독성 최우선
3. **고정된 장바구니** - 하단에 항상 표시 (주문 내역 확인)
4. **실시간 상태 업데이트**
   - 주문 후: "주문이 접수되었습니다"
   - 조리 시작: "조리가 시작되었습니다"
   - 조리 완료: "🔔 조리가 완료되었습니다! 픽업해주세요"
5. **완료 알림**
   - 진동 (Vibration API)
   - 푸시 알림
   - 화면에 큰 모달
6. **이전 주문 확인** - 같은 테이블의 과거 주문 조회 가능

**화면 구조:**

```
┌─────────────────────────────┐
│ 🏪 A부스 - 떡볶이집         │ ← 상단바 (부스명)
├─────────────────────────────┤
│                             │
│ ┌─────────┐ ┌─────────┐   │
│ │ [이미지]│ │ [이미지]│   │
│ │ 떡볶이  │ │ 순대    │   │
│ │ 8,000원 │ │ 7,000원 │   │
│ │ [+담기] │ │ [+담기] │   │
│ └─────────┘ └─────────┘   │
│                             │
│ ┌─────────┐ ┌─────────┐   │
│ │ [이미지]│ │ [이미지]│   │
│ │ 튀김    │ │ 라면    │   │
│ │ 5,000원 │ │ 6,000원 │   │
│ │ [+담기] │ │ [+담기] │   │
│ └─────────┘ └─────────┘   │
│                             │
├─────────────────────────────┤
│ 🛒 장바구니 (2개) 15,000원  │ ← 하단 고정
│ [주문하기]                  │
└─────────────────────────────┘
```

### 8.2 관리자 화면

#### 데스크톱 (주 사용)

```
┌────────────────────────────────────────────────┐
│ 🏪 A부스 관리              [매출] [설정] [⚙️]  │
├──────────────────────┬─────────────────────────┤
│ 📋 주문 목록 (왼쪽)   │ 💰 입금 확인 (오른쪽)   │
│                      │                         │
│ ┌──────────────────┐ │ ┌─────────────────────┐ │
│ │ #A-015 테이블3   │ │ │ 입금자명 확인       │ │
│ │ 떡볶이x2, 순대x1 │ │ │                     │ │
│ │ 15,000원         │ │ │ [배준재________]    │ │
│ │ 배준재           │ │ │                     │ │
│ │ 15:23 접수       │ │ │ 입금 금액           │ │
│ │                  │ │ │ [15000원_______]    │ │
│ │ [수락] [거절]    │ │ │                     │ │
│ └──────────────────┘ │ │ [확인]              │ │
│                      │ └─────────────────────┘ │
│ ┌──────────────────┐ │                         │
│ │ #A-016 테이블7   │ │ 💡 Tip:               │
│ │ ...              │ │ 입금자명과 금액을      │
│ └──────────────────┘ │ 확인 후 수락하세요     │
└──────────────────────┴─────────────────────────┘
```

**특징:**
- 좌우 분할 레이아웃 (주문 + 입금 확인)
- 원클릭 수락/거절
- 알림음 on/off 토글
- 실시간 매출 그래프

#### 모바일 (보조 사용)

```
┌───────────────────────┐
│ [주문] [매출] [설정]  │ ← 탭 전환
├───────────────────────┤
│ 📋 주문 목록          │
│                       │
│ ┌───────────────────┐ │
│ │ #A-015 테이블3    │ │
│ │ 떡볶이x2, 순대x1  │ │
│ │ 15,000원 (배준재) │ │
│ │ 15:23            │ │
│ │                   │ │
│ │ [수락] [거절]     │ │
│ └───────────────────┘ │
│                       │
│ ┌───────────────────┐ │
│ │ #A-016 테이블7    │ │
│ │ ...               │ │
│ └───────────────────┘ │
└───────────────────────┘
```

### 8.3 주방 화면

**목표:** 한눈에 모든 주문 파악, 빠른 조작

**핵심 원칙:**

1. **칸반 보드 스타일** - 대기중 / 조리중 / 완료 3칼럼
2. **테이블 번호 최우선** - 가장 크게 (24px+)
3. **터치 친화적 버튼** - 최소 48x48px (태블릿 고려)
4. **자동 경고** - 5분 이상 대기 시 빨간색 + 깜빡임
5. **알림음** - 새 주문 도착 시 "띵동" 소리
6. **페이지네이션** - 한 화면에 최대 20개

**화면 레이아웃:**
- 위에서 이미 설명한 칸반 보드 참조
- 태블릿 가로 모드 최적화 (1024x768)
- 스크롤 최소화

---

## 9. 핵심 제약사항

### 9.1 기술적 제약

| 제약 | 이유 | 해결 방법 |
|------|------|-----------|
| **테이블 수 최대 20개** | UI가 복잡해지고<br>주방 화면이 어지러움 | • 등록 시 경고 메시지<br>• 20개 초과 시 확인 필요<br>• 페이지네이션 필수 |
| **메뉴 개수 최대 30개** | 고객 선택 어려움<br>로딩 시간 증가 | • 카테고리 분류 (음식/음료/사이드)<br>• 품절 메뉴 숨김 처리 |
| **동시 접속 제한** | Socket.IO 연결 수<br>서버 부하 | • 부스당 최대 100명<br>• 대학당 최대 1000명<br>• 초과 시 대기열 |
| **이미지 크기 제한<br>(1장당 5MB)** | 로딩 속도<br>저장 공간 | • 자동 리사이징 (800x800)<br>• 80% 품질로 압축<br>• WebP 형식 사용 |
| **동영상 업로드 불가** | 저장 공간<br>로딩 시간 | • 이미지만 지원<br>• GIF도 제한 (5MB 이내) |

### 9.2 비즈니스 제약

1. **단기 운영 (2-3일)**
   - 축제 기간만 운영
   - 장기 데이터 보관 불필요
   - 축제 종료 후 30일간 보관 후 삭제

2. **사업자 등록 없음**
   - PG사 연동 불가
   - 계좌이체만 지원
   - 세금계산서 발행 불가

3. **책임 소재**
   - 플랫폼은 도구만 제공
   - 실제 운영은 부스 책임
   - 음식 안전, 위생은 부스 관리

4. **환불 처리**
   - 시스템 지원 없음
   - 직접 계좌이체로 처리
   - 환불 내역은 수동 기록

5. **고객 정보**
   - 로그인 불필요
   - 개인정보 수집 최소화
   - 입금자명만 수집

### 9.3 운영 제약

| 항목 | 제약 | 대응 방안 |
|------|------|-----------|
| **영업시간** | 축제 기간만 운영 | • 시작/종료 시간 설정<br>• 시간 외 주문 차단 |
| **재고 관리** | 실시간 재고 차감 | • 품절 시 자동 비활성화<br>• 관리자가 수동 조정 가능 |
| **주문 취소** | 결제 전만 가능 | • 결제 후 취소는 관리자 승인<br>• 환불은 수동 처리 |
| **네트워크 장애** | Wi-Fi 불안정 가능성 | • 오프라인 모드 지원 (우선순위 낮음)<br>• 재연결 시 자동 동기화 |

---

## 📚 부록

### A. 용어 정리

| 용어 | 설명 |
|------|------|
| **Tenant** | 독립적으로 시스템을 사용하는 단위 (여기서는 대학) |
| **Booth** | 부스, 실제 음식을 판매하는 단위 |
| **FSM** | Finite State Machine, 유한 상태 기계 |
| **Socket.IO Room** | 실시간 통신을 위한 논리적 그룹 |
| **Wizard** | 여러 단계로 나뉜 입력 폼 |
| **Kanban Board** | 작업 상태를 시각적으로 표시하는 보드 (트렐로 스타일) |
| **JWT** | JSON Web Token, 인증 토큰 |
| **QR** | Quick Response Code, 빠른 응답 코드 |

### B. 다음 단계

이 문서를 기반으로 다음 작업을 진행:

1. **DB 스키마 설계**
   - 테이블 정의
   - 관계 설정
   - 인덱스 전략

2. **API 명세서 작성**
   - RESTful API 엔드포인트
   - Socket.IO 이벤트 상세
   - 요청/응답 포맷

3. **UI/UX 와이어프레임**
   - Figma로 화면 설계
   - 인터랙션 정의
   - 반응형 레이아웃

4. **개발 우선순위**
   - Phase 1: 주문 + 주방 디스플레이
   - Phase 2: 부스 등록 + 통계
   - Phase 3: 대학 관리자 기능

---

## 📝 문서 이력

| 버전 | 날짜 | 변경 내용 | 작성자 |
|------|------|-----------|--------|
| 1.0 | 2024-XX-XX | 초안 작성 | - |
| 2.0 | 2025-11-10 | 로직 설계 개선, 주방 디스플레이 상세화 | Claude |

---

**🎉 이제 개발을 시작할 준비가 되었습니다!**